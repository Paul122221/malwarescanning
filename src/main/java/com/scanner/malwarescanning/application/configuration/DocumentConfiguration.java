package com.scanner.malwarescanning.application.configuration;

import com.scanner.malwarescanning.application.service.FileServiceImpl;
import com.scanner.malwarescanning.application.service.PdfTextParser;
import com.scanner.malwarescanning.domain.repository.DocumentRepository;
import com.scanner.malwarescanning.domain.service.*;
import com.scanner.malwarescanning.domain.service.impl.*;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import java.util.List;

@Configuration
public class DocumentConfiguration {

    @Autowired
    DocumentRepository documentRepository;

    @Value("${storage.path}")
    private String storagePath;

    @Value("${storage.temp}")
    private String storageTemp;

    @Value("${storage.test}")
    private String storageTest;

    @Bean(name = "InMemoryPDFDocumentService", destroyMethod = "deleteAll")
    @Autowired
    public DocumentService InMemoryPDFDocumentService(
            PdfTextParser pdfTextParser,
            AccountService accountService
    ){
        DocumentChecker documentChecker = new CombinationDocumentChecker(List.of(
                new PDFDocumentChecker(),
                new IBANDocumentChecker(pdfTextParser, accountService)
        ));
        return new DocumentServiceImpl(documentRepository, documentChecker, new FileServiceImpl(),  this.storagePath);
    }


    @Bean(name = "TXTDocumentService")
    @Autowired
    public DocumentService txtDocumentService(
            @Qualifier("TXTFileTextParser") FileTextParser txtFileTextParser,
            AccountService accountService
    ){
        DocumentChecker documentChecker = new DocumentCheckerImpl(txtFileTextParser, accountService);
        return new DocumentServiceImpl(documentRepository, documentChecker, new FileServiceImpl(), this.storagePath);
    }

}
