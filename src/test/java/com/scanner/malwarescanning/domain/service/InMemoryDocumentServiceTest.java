package com.scanner.malwarescanning.domain.service;

import com.scanner.malwarescanning.domain.entity.Document;
import com.scanner.malwarescanning.domain.repository.DocumentRepository;
import com.scanner.malwarescanning.domain.service.impl.DocumentServiceImpl;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;
import org.springframework.boot.test.context.SpringBootTest;
import java.io.File;

import static org.junit.jupiter.api.Assertions.*;

/**
 * This class contains unit tests for the {@link DocumentServiceImpl} class, specifically the methods related to saving and creating documents.
 */
@SpringBootTest
public class InMemoryDocumentServiceTest {

    private DocumentServiceImpl documentService;

    @Mock
    private DocumentRepository documentRepository;

    @Mock
    private DocumentChecker documentChecker;

    @Mock
    private FileService fileService;

    private String parentFolder;

    @BeforeEach
    public void setup() {
        MockitoAnnotations.initMocks(this);
        parentFolder = "testFolder";
        documentService = new DocumentServiceImpl(documentRepository, documentChecker, fileService, parentFolder);
    }

    /**
     * Tests the behavior of the {@link DocumentServiceImpl#save(File)} method.
     * It checks whether the document is saved correctly and its original name matches the file name.
     */
    @Test
    public void save(){
        File testFile = new File("test.pdf");
        Document document = documentService.save(testFile);

        assertNotNull(document);
        assertEquals(testFile.getName(), document.getOriginalName());
    }

    /**
     * Tests the behavior of the {@link DocumentServiceImpl#createFromFile(File)} method.
     * It checks whether a document is created correctly from a file, and the file extension matches the document extension.
     */
    @Test
    public void createFromFile(){
        File testFile = new File("test.pdf");
        Document document = documentService.createFromFile(testFile);

        String extensionFile = testFile
                .getName()
                .replaceAll(".+\\.(.+)$", "$1");

        String extensionDocument = document
                .getFullPath()
                .replaceAll(".+\\.(.+)$", "$1");

        assertNotNull(document);
        assertEquals(testFile.getName(), document.getOriginalName());
        assertEquals(extensionFile, extensionDocument);
    }
}
